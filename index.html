<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="https://fonts.lug.ustc.edu.cn/css?family=Open Sans:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Ruby, Rails" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="程序员，玩家，死理性派，工具控，拖延症，右脑探索者">
<meta property="og:type" content="website">
<meta property="og:title" content="Vincent Zhao">
<meta property="og:url" content="http://zhaowen.me/index.html">
<meta property="og:site_name" content="Vincent Zhao">
<meta property="og:description" content="程序员，玩家，死理性派，工具控，拖延症，右脑探索者">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vincent Zhao">
<meta name="twitter:description" content="程序员，玩家，死理性派，工具控，拖延症，右脑探索者">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhaowen.me/"/>





  <title>Vincent Zhao</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-43899568-1', 'auto');
  ga('send', 'pageview');
</script>











</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Vincent Zhao</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Just some thoughts to output</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2018/01/01/top-5-of-2017/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/01/top-5-of-2017/" itemprop="url">2017 年的 Top 5</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-01T12:52:00+08:00">
                2018-01-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/weblog/" itemprop="url" rel="index">
                    <span itemprop="name">weblog</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>排名不分先后。</p>
<h2 id="书"><a href="#书" class="headerlink" title="书"></a>书</h2><ul>
<li>自由 by Jonathan Franzen</li>
<li>创新公司：皮克斯的启示 by Ed Catmull / Amy Wallace</li>
<li>纽约无人是客 by 沈辛成</li>
<li>騎士団長殺し by 村上春樹</li>
<li>成为乔布斯 by Brent Schlender / Rick Tetzeli</li>
</ul>
<h2 id="电影"><a href="#电影" class="headerlink" title="电影"></a>电影</h2><ul>
<li>Billy Lynn’s Long Halftime Walk (比利·林恩的中场战事)</li>
<li>Manchester by the Sea (海边的曼彻斯特)</li>
<li>La La Land (爱乐之城)</li>
<li>Before Sunrise (爱在黎明破晓前)</li>
<li>Sing Street (初恋这首情歌)</li>
</ul>
<h2 id="电视剧"><a href="#电视剧" class="headerlink" title="电视剧"></a>电视剧</h2><ul>
<li>Black Mirror Season 3</li>
<li>Better Call Saul Season 3</li>
<li>The Wire Season 1</li>
<li>ゆとりですが、なにか</li>
<li>Chef’s Table Season 1</li>
</ul>
<h2 id="游戏"><a href="#游戏" class="headerlink" title="游戏"></a>游戏</h2><ul>
<li>塞尔达传说：荒野之息</li>
<li>Metal Gear Solid 4</li>
<li>二ノ国</li>
<li>Super Mario Run</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2015/04/10/take-a-day-off/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/04/10/take-a-day-off/" itemprop="url">怎样让自己休一天假</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-04-10T09:27:00+08:00">
                2015-04-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/liberal-translation/" itemprop="url" rel="index">
                    <span itemprop="name">liberal-translation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文：<a href="http://www.raptitude.com/2015/03/how-to-take-a-day-off/" target="_blank" rel="external">How to Take a Day Off</a></p>
<p>我印象中的父亲是全年无休的。当然他肯定休过假，但我从来没有目睹过。我无法想象他起床以后无所事事的样子，他总是让自己马不停蹄。</p>
<p>星期六早上8点，当我挪向沙发准备看动画片的时候，他显然已经忙活一阵了，正热火朝天地制作或修补着什么。</p>
<p>他在晚上也会读会儿书或看会儿电视。但是放自己一整天假——意思是在这一天不制作东西，不安排时间，或者不推进任何事情的进度——对他来说是个陌生的概念。</p>
<p>我对工作的热情还不及他的一半，但最近我意识到了自己在做同样的事：我将周末，也就是我的“假期”，视为一个额外的时间来让自己再多做一些，即使只做我喜欢的那些工作。</p>
<p>在几个星期前，我让自己度过了一天真正的假期，我有意识地让自己在那一天不做任何与自我提升，任何与维护自己的身份相关的事情。我在前一天晚上就下定决心：抛掉工作，抛掉目标，抛掉想要<strong>收获</strong>些什么的念头。</p>
<p>那一天我花了很多时间在户外，造访了四组挚爱的人们，在另外的时间里我也没有匆忙去赶赴下一个约会，也没有进行过多的思考。早晨我和女朋友一起度过，中午和一位朋友一起吃午饭，下午陪着母亲在外面散步，与妹妹一家一起共进了晚餐，晚上找了一本书来读。</p>
<p>我入睡的时候感觉很棒，我觉得生活充满美妙，所以我才<strong>能够</strong>度过这样的一天，那天我睡得好极了。</p>
<p>如果这都不算是完美的一天，我实在不知道什么才是了。现在想来，那一天与平时周末最显著的不同，就是我几乎没有去留意<strong>时间</strong>的流逝。我不再抱有为了将来而做些什么的想法。唯一的目的就是享受每一刻中自己所置身的环境以及面对的人物，在当你没有下一步打算的时候，这是很容易达到的。</p>
<p>第二天我又回到了工作中，这次却没有如往常一样感觉到抵触的情绪，我完成了很多工作。我在放假那天悠然自得的状态似乎被延续到了第二天的工作日。它让我对当下的状态感到满足，让我觉得不需要急着去<strong>赶超</strong>我当前的工作进度。</p>
<h2 id="失传的休假艺术"><a href="#失传的休假艺术" class="headerlink" title="失传的休假艺术"></a>失传的休假艺术</h2><p>现在人们可能觉得一个礼拜都不好好休息一天是无法接受的，我也一直在宣扬一个已几乎将要绝迹的提议，那就是空出一整天来让自己远离工作。我们很多人从来没有这么做过，或是自己根本没有意识到。我们会习惯性地在周末给自己找些活来干，如果我们一整天无所事事，我们就会感觉愧疚。</p>
<p>有意识地让自己从“不断追赶”的状态中走出来，能够提醒你其实在很多方面你已经“走在前列”了。如果你从来没有经历过<strong>处于</strong>领先，那么不断追赶还有什么意义呢？</p>
<p>在继续之前，我们应该明确真正的放假是什么样子。究竟应该放掉<strong>什么</strong>呢？</p>
<p>在这一天，我们会放弃所有为了金钱、名誉、地位、或者社会责任而行动的想法，不再把时间视为对理想未来的一种投资或者为了日后获益的一项交易。</p>
<p>真正的休假并不是懒惰或者逃避责任的借口。事实上，真正的休假是在这一天去探索一些其他方面的责任：试着去成为一个传播欢乐和给予陪伴的朋友、家长、子女、甚至陌生人。</p>
<p>同时这也是体验身为一名现代文明的成员的机会。真正的休假正是一个绝佳的时机去体验人类发展进程中的璀璨结晶：去欣赏艺术，聆听音乐，造访公共空间。尤其是当我们的其他六天里都充斥着糟糕的事物：缺乏同情心的公司、腐败的政府、索然无味的明星文化、以及只会输出负面新闻的媒体。</p>
<h2 id="休假的6个准则"><a href="#休假的6个准则" class="headerlink" title="休假的6个准则"></a>休假的6个准则</h2><p>下面是一些综合性的准则来确保我们的假日不被侵犯。</p>
<h3 id="1-拒绝工作，拒绝“追赶”"><a href="#1-拒绝工作，拒绝“追赶”" class="headerlink" title="1. 拒绝工作，拒绝“追赶”"></a>1. 拒绝工作，拒绝“追赶”</h3><p>如果“不断追赶”真的有其价值的话，那就是你可以处于领先。真正的休假就是让追赶过程中的角色颠倒，让自己处于领先——享受你（和他人）辛勤劳动的成果——而不是给自己安排更多的劳动。</p>
<p>这一点可以浓缩为，“今天，只做着眼当前的事，不做着眼未来的事。”意思是不做琐事，不进行功利性消费，当然也不大规模消费。说真的，你在家居中心晃荡什么呢？快去公园吧。尽管大多数人把休闲性购物视为打发时间最好的方式，但这与我们的休假决然相悖。在这个劳动型社会中，购物消费这个行为有着太多的情感上的牵扯。重新认识“不断追赶”并不意味着在假日中为了满足庸俗的购物欲而挥霍你数小时的劳动成果，从而让自己不必要地又变得<strong>落后</strong>。</p>
<p>造访一间古玩商店，或者农庄市场，或者在个人车库中举办的旧货卖场是休假时不错的选择，而百货商店或沃尔玛显然不是。</p>
<h3 id="2-不要待在家里"><a href="#2-不要待在家里" class="headerlink" title="2. 不要待在家里"></a>2. 不要待在家里</h3><p>虽然有人会选择花一天时间在沙发上裹着睡衣重温老电影，然而这样却构不成一个真正的休假——这样的一天过于熟悉，毫无新奇感，而且多数人会在傍晚会因为虚度了一天而陷入深深的愧疚感。</p>
<p>大体来说，真正的休假发生在户外。如果你一年中从来没有去过公园，哪怕是在赴约的路上，那就太遗憾了。</p>
<p>也不要花太多的时间待在车里。用起你的双腿，或者自行车。汽车总是会给我们造成还有别的地方要去的错觉。</p>
<h3 id="3-陪伴所爱的人"><a href="#3-陪伴所爱的人" class="headerlink" title="3. 陪伴所爱的人"></a>3. 陪伴所爱的人</h3><p>要么找一个同伴共度假日，要么计划着造访一两个人。虽然你可能找不到人在早上陪你参观博物馆，但你一定可以邀请到人陪你共进午餐或者在咖啡馆见个面。</p>
<p>一位性格温和的同伴是最适合的人选，哪怕只陪伴你一小段时间——可以是你的另一半，你的朋友，或者你的孩子。处于他人的陪伴时，我们很难去思考“今后”的事，也有助于我们去感激那些我们在独处时无法发现的事物。</p>
<p>毕竟，与所爱之人共通度过的美好时光是我们人生中最宝贵的片段。当我们只身远行时所思念的，当我们锒铛入狱时所渴望的，当我们在弥留之际仍然视为珍宝的，都是这些时光。</p>
<h3 id="4-宽松地计划，但不要排日程表"><a href="#4-宽松地计划，但不要排日程表" class="headerlink" title="4. 宽松地计划，但不要排日程表"></a>4. 宽松地计划，但不要排日程表</h3><p>只要在心里对要去的几个地方有数就行了。虽说是自由的一天，但也需要果断。提前想好要去镇上的哪些地方，要在何处逗留，是去跳蚤市场还是海边沙滩。</p>
<p>明确你要和哪些朋友或亲爱的人见面也有助于度过假日。提前计划好午餐也颇为明智，否则你们碰头后只会到处游荡直到找到一个不错的地方。或许你想要的是一次野餐。</p>
<p>另一个大的原则：不要只做一件事。在会展中心待上一整天很难让人体会到假日里自由自在的感觉。早一些起床，让自己有充裕的时间来安排多件事情，但不要总是看时间。</p>
<p>探寻那些免费或者便宜的活动。对我们大部分人来说，金钱总是与时间和工作密切相关，而这两者正是我们想要在这一天抛至脑后的。</p>
<h3 id="5-将电子设备的使用减到最少"><a href="#5-将电子设备的使用减到最少" class="headerlink" title="5. 将电子设备的使用减到最少"></a>5. 将电子设备的使用减到最少</h3><p>或者至少只将其用于赶路（如电子地图）或者用来和朋友联系。在一周的其他时间里我们已经面对着屏幕够多了。</p>
<p>不停地刷新闻或者邮件让我们对<strong>时间</strong>产生了不健康的高度警觉，这是我们在假日想要极力摆脱的。我们经常会借助时钟来衡量这一天“做得怎么样”。而到了真正的休假时，我们如无必要，不看时间。记住：<strong>不管现在几点，都没事。</strong></p>
<p>当然也不要成为勒德分子（Luddite）。没必要把这一天作为抵制科技日。但是如果你要进行一些被动性的电子娱乐活动（如电影或电视）时，只有别无选择时才考虑它们，并且如果可能的话，找个人和你一起看。</p>
<h3 id="6-享受文明的成果"><a href="#6-享受文明的成果" class="headerlink" title="6. 享受文明的成果"></a>6. 享受文明的成果</h3><p>我们对文明的弊病冷嘲热讽，以至于我们认为其美好是理所当然的。虽然抱怨不断，但事实上我们身边充满着不可思议的悦人之物和文化设施，其中很多存在的意义只是为了给予我们欢愉和幸福。假日正是绝佳的时机去使用你身边的公园、博物馆、画廊、市场、公共空间、表演场所、以及历史建筑。</p>
<p>查阅当地的活动日程，看看正在上演着什么。如果你住在城市里，你会惊奇地发现每天都有如此丰富的活动——免费的音乐会、艺术展览、读书会、聚会、比赛、品酒会等。</p>
<p>我们工作的目的就是为了能提升自己生活的<strong>质量</strong>，无论是公开的还是私下的。所以当我们真正拥有了这些高质量的事物时别忘了尽情享受它们，并且在享受时将工作完全抛至脑后。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2015/04/04/write-a-template-engine-in-less-than-30-lines-of-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/04/04/write-a-template-engine-in-less-than-30-lines-of-code/" itemprop="url">如何用少于30行代码实现一个模板引擎</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-04-04T19:27:00+08:00">
                2015-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/translation/" itemprop="url" rel="index">
                    <span itemprop="name">translation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文： <a href="http://bits.citrusbyte.com/how-to-write-a-template-library/" target="_blank" rel="external">How to write a template engine in less than 30 lines of code</a></p>
<p>声明：本文基于模板引擎库 <a href="https://github.com/soveran/mote" target="_blank" rel="external">mote</a>。其简洁的代码赋予了我灵感，如果你之前没有探索过模板引擎的内部实现，相信这会是一个绝佳的学习范例。</p>
<h2 id="前言：-什么是模板？"><a href="#前言：-什么是模板？" class="headerlink" title="前言： 什么是模板？"></a>前言： 什么是模板？</h2><p>模板引擎是一种使用模板来生成文本（字符串）的工具，它还有助于将呈现逻辑与应用逻辑分离。</p>
<p>除非你正在某些有悠久历史的软件代码中挣扎（或者你开发的是没有用户界面的软件），否则你极有可能已经接触过模板引擎了。</p>
<p>但是你有没有思考过模板引擎的工作原理呢？你尝试过自己来构建一个吗？如果我们来瞥一眼主流的模板引擎的代码库，你会看到有<a href="https://github.com/ruby/ruby/blob/trunk/lib/erb.rb" target="_blank" rel="external">几百行(erb)</a>的代码，甚至<a href="https://github.com/genki/erubis/" target="_blank" rel="external">几千行(erubis)</a>。即使是名叫 <a href="https://github.com/slim-template/slim" target="_blank" rel="external">slim</a> 的家伙也并没有那么苗条。</p>
<p>所以你或许会觉得处理模板是一个相当复杂的问题，然而下面我会一步步地向你展示其实你可以只用少量代码就构建出一个模板引擎。</p>
<p>那让我们开始吧。</p>
<h2 id="定义特性"><a href="#定义特性" class="headerlink" title="定义特性"></a>定义特性</h2><p>本文我们将要实现的模板引擎只有两条规则：</p>
<ol>
<li>以 % 开头的行会被解释为 Ruby 代码。</li>
<li>可以把 Ruby 代码插入到任何行中 {{ … }} 符号的中间。比如我们可以使用 <code>{{ article.title }}</code>。</li>
</ol>
<p>完了？就两条规则？没错，记住，第一条规则让我们可以访问 Ruby 的一切，也就是说所有常见的模板特性（比如循环、调用上层函数、嵌入 partial 等）都可以实现。如此简单的特性甚至还带来了一个额外的好处：你不需要去学一个新的模板语言或者 DSL，因为你已经会 Ruby 了。</p>
<p>你可以这样来调用其他模板：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">% render(&quot;path/to/template.template&quot;, &#123;&#125;)</div></pre></td></tr></table></figure>
<p>也可以写注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">% # this is a comment</div></pre></td></tr></table></figure>
<p>或者执行 blocks ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">% 3.times do |i|</div><div class="line">&#123;% raw %&#125;&#123;&#123;&#123;% endraw %&#125;i&#123;% raw %&#125;&#125;&#125;&#123;% endraw %&#125;</div><div class="line">% end</div></pre></td></tr></table></figure>
<p>根据上面的特性，我们可以来编写一个示例模板：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">&lt;body&gt;</div><div class="line">% if access == 0</div><div class="line">  &lt;div&gt; no access :( &lt;/div&gt;</div><div class="line">% else</div><div class="line">  &lt;ul&gt;</div><div class="line">  % data.each do |i|</div><div class="line">    &lt;li&gt;&#123;% raw %&#125;&#123;&#123;&#123;% endraw %&#125;i&#123;% raw %&#125;&#125;&#125;&#123;% endraw %&#125;&lt;/li&gt;</div><div class="line">  % end</div><div class="line">  &lt;/ul&gt;</div><div class="line">% end</div><div class="line">% # comments are just normal ruby comments</div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>下面我们称这个模板为 <code>index.template</code>。</p>
<p>下面我们要做的就是怎样编写一个方法来解析这个模板并输出正确的字符串。在此之前，我们先来看一个中间步骤：如何使用纯粹的 Ruby 代码来输出 HTML。</p>
<h2 id="与-index-template-行为相同的-render-函数"><a href="#与-index-template-行为相同的-render-函数" class="headerlink" title="与 index.template 行为相同的 render 函数"></a>与 index.template 行为相同的 render 函数</h2><p>在模板引擎出现以前，你同样可以使用纯 Ruby 来达到与 <code>index.template</code> 一样的效果，就像下面的代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">render_index</span><span class="params">(access, data)</span></span></div><div class="line">  output = <span class="string">""</span> <span class="comment"># 一个新的字符串，用来存放输出的内容</span></div><div class="line">  output &lt;&lt; <span class="string">"&lt;html&gt;"</span></div><div class="line">  output &lt;&lt; <span class="string">"&lt;body&gt;"</span></div><div class="line"></div><div class="line">  <span class="keyword">if</span> access == <span class="number">0</span></div><div class="line">    output &lt;&lt; <span class="string">"&lt;div&gt; no access :( &lt;/div&gt;"</span></div><div class="line">  <span class="keyword">else</span></div><div class="line">    output &lt;&lt; <span class="string">"&lt;ul&gt;"</span></div><div class="line">    data.each <span class="keyword">do</span> <span class="params">|i|</span></div><div class="line">      output &lt;&lt; <span class="string">"&lt;li&gt;<span class="subst">#&#123; i &#125;</span>&lt;/li&gt;"</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">    output &lt;&lt; <span class="string">"&lt;/ul&gt;"</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  output &lt;&lt; <span class="string">"&lt;/body&gt;"</span></div><div class="line">  output &lt;&lt; <span class="string">"&lt;/html&gt;"</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> output</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>你可以把它粘贴到 IRB 中试试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt; render_index(0,[&quot;foo&quot;, &quot;bar&quot;])</div><div class="line">=&gt; &quot;&lt;html&gt;&lt;body&gt;&lt;div&gt; no access :( &lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&quot;</div><div class="line">&gt;&gt; render_index(1,[&quot;foo&quot;, &quot;bar&quot;])</div><div class="line">=&gt; &quot;&lt;html&gt;&lt;body&gt;&lt;ul&gt;&lt;li&gt;foo&lt;/li&gt;&lt;li&gt;bar&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/html&gt;&quot;</div></pre></td></tr></table></figure>
<p>假如你的应用涉及的范围非常有限，或许你就根本用不着模板引擎，这样就大功告成了！你可以根据需要自己编写 <code>render_index()</code>、<code>render_header()</code>、<code>render_footer()</code> 方法。PHP 本身其实就是一个模板引擎，这也解释了为什么 PHP 社区的人们会经常这么做。</p>
<p>然而我们来看 <code>render_index()</code> 的目的是为了探寻如何将 <code>index.template</code> 转换成 <code>render_index()</code> ，并将转换的方法共通化，这样我们的模板引擎就出来了。我们并不想真的去编写 <code>render_index()</code>、<code>render_header()</code>、<code>render_footer()</code> 方法，也不想用代码生成器来实现。我们想要的是能够动态生成一个行为类似 <code>render_index()</code> 的方法，而不是亲手来写 <code>render_index()</code> 方法的代码。</p>
<p>在看具体的实现方式之前， 我们再来看一个中间步骤：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">define_render_index</span><span class="params">()</span></span></div><div class="line"></div><div class="line">  func = <span class="string">""</span> <span class="comment"># 空字符串，用来存储构建方法的字符串</span></div><div class="line">  func &lt;&lt; <span class="string">"def render_index(access, data) \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"output = \"\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"output &lt;&lt; \"&lt;html&gt;\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"output &lt;&lt; \"&lt;body&gt;\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"if access == 0\n"</span></div><div class="line">  func &lt;&lt; <span class="string">"  output &lt;&lt; \"&lt;div&gt; no access :( &lt;/div&gt;\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"else\n"</span></div><div class="line">  func &lt;&lt; <span class="string">"   output &lt;&lt; \"&lt;ul&gt;\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"      data.each do |i|\n"</span></div><div class="line">  func &lt;&lt; <span class="string">"        output &lt;&lt; \"&lt;li&gt; \#&#123; i &#125; &lt;/li&gt;\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"      end \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"   output &lt;&lt; \"&lt;/ul&gt;\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"end\n"</span></div><div class="line">  func &lt;&lt; <span class="string">"  output &lt;&lt; \"&lt;/body&gt;\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"  output &lt;&lt; \"&lt;/html&gt;\" \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"  return output \n"</span></div><div class="line">  func &lt;&lt; <span class="string">"end\n"</span></div><div class="line"></div><div class="line">  eval(func)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>你可以把它粘贴到 IRB 中并调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt; define_render_index() </div><div class="line">=&gt; nil</div><div class="line">&gt;&gt; render_index(1, [&quot;foo&quot;, &quot;bar&quot;])</div><div class="line">=&gt; &quot;&lt;html&gt;&lt;body&gt;&lt;ul&gt;&lt;li&gt;foo&lt;/li&gt;&lt;li&gt;bar&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/html&gt;&quot;</div></pre></td></tr></table></figure>
<p>现在我们就得到一个更为完整的蓝图了：我们可以将原始的模板逐行转换为一系列字符串，然后修改这些字符串使其能够被 Ruby 解释。生成了这个方法以后，在调用它时就会执行我们所期望的模板的行为。</p>
<p>上面这个逐行转换的过程就是我们的 <code>parse</code> 方法的根基，下面就让我们具体来看。</p>
<h2 id="Parse-方法"><a href="#Parse-方法" class="headerlink" title="Parse 方法"></a>Parse 方法</h2><h3 id="1-使用-Proc"><a href="#1-使用-Proc" class="headerlink" title="1. 使用 Proc"></a>1. 使用 Proc</h3><p>我们不想让 <code>func</code> 字符串像 <code>define_render_index()</code> 一样以一个具名函数开头，所以我们用 Proc 并将其保存至一个变量，有需要时就 <code>.call</code> 它。</p>
<h3 id="2-设定-Proc-的变量"><a href="#2-设定-Proc-的变量" class="headerlink" title="2. 设定 Proc 的变量"></a>2. 设定 Proc 的变量</h3><p><code>define_render_index()</code> 还写死了其中的变量： access 和 data。但我们需要将变量名传给 <code>parse</code> 函数，这样才能构建定义 Proc 的字符串。这里我们把变量名直接以字符串形式传递给 parse 方法，就像这样：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">parse(template, <span class="string">"access, data"</span>)</div></pre></td></tr></table></figure>
<h3 id="3-将模板逐行转译成函数字符串"><a href="#3-将模板逐行转译成函数字符串" class="headerlink" title="3. 将模板逐行转译成函数字符串"></a>3. 将模板逐行转译成函数字符串</h3><p>上面的 <code>define_render_index()</code> 已经告诉我们逐行处理模板来创建一个新的 Ruby 方法时所需遵循的规则了。这些规则就是：</p>
<ul>
<li><p>所有的双引号必须被转义，每一行的内容用双引号围起来，并在每一行的最后添加换行符 “\n”。</p>
</li>
<li><p>如果行的第一个字符（不包括空格 ）是 <code>%</code>，就把 <code>%</code> 删除。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">变换前:</div><div class="line">  % if data.empty? </div><div class="line">变换后:</div><div class="line">  &quot;if data.empty?\n&quot;</div></pre></td></tr></table></figure>
<ul>
<li>其他的所有行都在前面加上 <code>&quot;output &lt;&lt;&quot;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">变换前:</div><div class="line">  &lt;html&gt;</div><div class="line">变换后:</div><div class="line">  &quot;output &lt;&lt; \&quot;&lt;html&gt;\&quot; \n&quot;</div></pre></td></tr></table></figure>
<h3 id="4-…-会被变换为-…"><a href="#4-…-会被变换为-…" class="headerlink" title="4.  …  会被变换为 #{ … }"></a>4. {{ … }} 会被变换为 #{ … }</h3><p>我们会使用正则表达式来实现这一点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">变换前:</div><div class="line">  &lt;li&gt;&#123;% raw %&#125;&#123;&#123;&#123;% endraw %&#125; i &#123;% raw %&#125;&#125;&#125;&#123;% endraw %&#125;&lt;/li&gt; </div><div class="line">变换后:</div><div class="line">  &quot;output &lt;&lt; \&quot;&lt;li&gt; \#&#123; i &#125; &lt;/li&gt;\&quot; \n&quot;</div></pre></td></tr></table></figure>
<p>要运用上述规则，我们首先要用 <code>.split(&quot;\n&quot;)</code> 将原始模板文件分割成数组，这样数组中的每个元素就是模板文件的每一行了。然后循环这个数组来构建 <code>func</code> 字符串，并最终将其 <code>eval</code>。</p>
<p>最后，我们得到的 parse 函数如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(template,vars = <span class="string">""</span>)</span></span></div><div class="line">  lines = File.read(template).split(<span class="string">"\n"</span>)</div><div class="line"></div><div class="line">  func = <span class="string">"Proc.new do |<span class="subst">#&#123;vars&#125;</span>| \n output = \"\" \n "</span></div><div class="line"></div><div class="line">  lines.each <span class="keyword">do</span> <span class="params">|line|</span></div><div class="line">    <span class="keyword">if</span> line =~ <span class="regexp">/^\s*(%)(.*?)$/</span></div><div class="line">     func &lt;&lt; <span class="string">" <span class="subst">#&#123;line.gsub(<span class="regexp">/^\s*%(.*?)$/</span>, <span class="string">'\1'</span>) &#125;</span> \n"</span> </div><div class="line">    <span class="keyword">else</span></div><div class="line">     func &lt;&lt; <span class="string">" output &lt;&lt; \" <span class="subst">#&#123;line.gsub(<span class="regexp">/\&#123;\&#123;([^\r\n\&#123;]*)\&#125;\&#125;/</span>, <span class="string">'<span class="subst">#&#123;\<span class="number">1</span>&#125;</span>'</span>) &#125;</span>\" \n "</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  func &lt;&lt; <span class="string">" output; end \n "</span></div><div class="line"></div><div class="line">  eval(func)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>你可以在 IRB 中亲自尝试一番：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;&gt; index = parse(&quot;index.template&quot;, &quot;access, data&quot;)</div><div class="line">=&gt; nil</div><div class="line">&gt;&gt; index.call(1,[&quot;Foo&quot;]) </div><div class="line">=&gt; &quot; &lt;html&gt;\n &lt;body&gt;\n&lt;ul&gt;\n&lt;li&gt;foo&lt;/li&gt; \n&lt;/ul&gt;\n &lt;/body&gt;\n &lt;/html&gt;\n&quot;</div></pre></td></tr></table></figure>
<p>大功告成了！就这么几行代码，你就实现了一个颇为强劲的模板引擎了。由于没有涉及太多多余的功能，我们将复杂度降到了最低，也提高了模板语言的清晰程度。复杂度的降低能够让应用程序条例更清晰，更不容易出错，还能加快开发特性的速度。</p>
<h2 id="它能扩展（Scale）吗？"><a href="#它能扩展（Scale）吗？" class="headerlink" title="它能扩展（Scale）吗？"></a>它能扩展（Scale）吗？</h2><p>这里的代码不行！但是 <a href="https://github.com/soveran/mote" target="_blank" rel="external">mote</a>，也就是本文的灵感来源，当然可以。mote 附带了一些 helper 方法和缓存功能，我们已经成功将其运用在了各种大型的 Web 应用中。更不用提 <a href="https://github.com/soveran/mote/blob/master/benchmarks/result.txt" target="_blank" rel="external">mote 的速度相当快</a>。</p>
<p>同时我还想就其简洁这个显著的特点说两句——虽然 mote 的体积极其小，但对于其要解决的问题给出了一个专注而又完整的解决之道。</p>
<p>我希望这篇文章能够会对从未探寻过模板引擎的人或者想要做一个模板引擎的人有所帮助。欢迎留下你的评论或者反馈。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2015/02/05/my-2014/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/02/05/my-2014/" itemprop="url">我的2014</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-02-05T19:52:00+08:00">
                2015-02-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/weblog/" itemprop="url" rel="index">
                    <span itemprop="name">weblog</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2015年已经过去了一个多月，自己也曾一度想过放弃写这篇年度总结，因为过去的2014年可写的亮点似乎寥寥无几。但不论如何，毕竟是自己独一无二的一年，就算谈不上丰富多彩，也值得用一篇文章来留下印记。</p>
<h2 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h2><p>2014年做了很多翻译。</p>
<p>在简书上发表了<a href="http://www.jianshu.com/users/Me7Qst/latest_articles" target="_blank" rel="external">一些 Zenhabits 的博客的译文</a>，在这里翻译了<a href="http://zhaowen.me/blog/categories/translation/">一些 Ruby 相关的技术文章</a>。前一年翻译的<a href="http://www.ituring.com.cn/book/1249" target="_blank" rel="external">《Web 应用安全权威指南》</a>得以出版，这一年又翻译了<a href="http://www.ituring.com.cn/book/1339" target="_blank" rel="external">《关于 mruby 的一切》</a>这本小书。</p>
<p>回想最初会开始翻译的动机，单纯只是想要提高自己的中文水平。但一年多下来，说实话并没有感觉自己驾驭文字的水平有很大的提高。过去的一年也没有写出几篇原创的文章，着实有些沮丧。</p>
<p>然而，这些翻译工作也带来了一些预料之外的收获。发表在简书上的文章受到了很多用户的喜欢；通过 Google Analytics 可以看到每天都有一些人通过 Google 搜索来到这里；在图灵翻译了两本书后，不久前又收到了翻译杂志连载的邀请。看到自己的翻译成果能够对别人有所帮助，无疑是最开心的事了。</p>
<h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p>过去一年主要还是在做 Ruby 相关的 Web 项目。在经历了种种坑后，客户终于逐渐抛弃了 Windows + JRuby 的奇葩组合，走向了 Linux + MRI 的正路。</p>
<p>受外包项目性质所限，虽然在工作中能够使用自己喜欢的技术栈，但是久了以后还是会感觉工作内容的单调。像前端页面端的技术或部署上线等由客户负责的工作自己始终无法得到实践的机会。另外，公司执行的网络封锁使得开发工作举步维艰，老旧的开发机器也严重影响效率和心情。</p>
<p>年初的时候尝试过一次换工作，由于能力有限未能通过面试。由于家乡几乎没有的 Ruby 氛围，所以后来老婆怀孕之后也就暂时没有再尝试了。现在的工作中惟一值得庆幸的，是我所在项目组的工作强度一向很低，大约只需要花上最初估算时间的一半就能够做完。所以在出勤的日子里，自己基本上能够抽出一半的时间来自由地学习，这也是我能够说服自己继续留下来的理由。</p>
<p>现在能做的是努力提高自己，等到机会真的出现的时候，不会因为准备不足而悔恨。</p>
<h2 id="习惯养成"><a href="#习惯养成" class="headerlink" title="习惯养成"></a>习惯养成</h2><p>前一年的总结中提到过，自己尝试过多款习惯养成的 app 却未果。在2014年，我决定重点培养跑步这个习惯。</p>
<p>这决不是第一次启动跑步习惯了，之前一直没能成功的原因是找不到合适的时间和地点。在这一年，我近乎完美的解决了这个难题。工作日每天下午3点，办公室就会响起广播体操的音乐。同样是以锻炼身体为目的，与其做傻不拉叽的体操，不如走出公司去跑步。公司附近人烟稀少，正是跑步的绝佳场所。下午3点时的肠胃也没有太大的负担。就这样，时间和地点的问题得到一并解决。</p>
<p>除去夏日的酷暑天气，我基本做到了没有出现特别大的间断，坚持了下来。由于是上班时间，所以也不能出去太久，一般一次也就2公里左右。根据记录的软件，一年下来超过了100多公里。虽然成绩不足挂齿，但很高兴自己坚持了下来。</p>
<h2 id="2013年设定的目标"><a href="#2013年设定的目标" class="headerlink" title="2013年设定的目标"></a>2013年设定的目标</h2><p>在2013年总结的最后，我写的是希望在2014年能够养成几个好的习惯，学习一门新的语言，读更多的书。</p>
<p>习惯方面，除了刚刚提到的跑步，2014年养成的另一个让自己受益良多的新习惯是听播客（Podcast）。这两个习惯相辅相成，跑步的时候听播客，有特别想听的播客时就会逼迫自己在跑步时才能听。一年下来，出门在外时耳机里播放的内容也逐渐地从音乐全部变成了播客。</p>
<p>2014年我没有学习新的语言，而是第一次较为系统地学习了一遍 JavaScript。JavaScript 对我来说也算半个新语言，所以这个目标只能算完成了一半。读书的目标从上个月整理的读书清单来看也顺利达成了。</p>
<p>这么一看，似乎去年在实现目标这方面还算令人满意。</p>
<h2 id="角色的转变"><a href="#角色的转变" class="headerlink" title="角色的转变"></a>角色的转变</h2><p>5月份的时候，老婆怀孕了。这无疑是2014年个人的最大事件，从此我的生活发生了较大的变化。</p>
<p>曾经认为有了孩子之后的日子就好比世界末日，可供自己支配的时间大幅减少，最终沦为纯粹为了生活而奔波的行尸走肉。所以一直以来，我都以一己之力对抗外界的压力。可惜的是，在这一点上身边找不到一个盟友。同时也考虑到老婆即将告别适孕年龄，所以在这一年，我向这个世界屈服了。</p>
<p>翻看在自己得知怀孕后的日子里写下的日记，很长一段时间内都沉浸在悲观和消极的情绪中。时间变少，效率底下，无法专注，找不到动力。但幸好后来还是把心态调整过来了，我慢慢认识到问题还是出在自身，不应该寻找借口，去归咎于外界。</p>
<p>写下这篇文章的时候，自己的孩子已在一周前降临。角色的转变必定会成为今年最大的主题，挑战才刚刚开始。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2015/01/04/book-2014/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/01/04/book-2014/" itemprop="url">2014年读书单</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-04T20:10:00+08:00">
                2015-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/weblog/" itemprop="url" rel="index">
                    <span itemprop="name">weblog</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2014年我读完了36本书，其中有一些是前一年开始读的，只是在这一年内看完。</p>
<p>在写<a href="http://zhaowen.me/blog/2014/01/01/book-2013/">前年的读书清单</a>时就发现电子书有增多的趋势，去年这么多书里面，更是只有4本是纸质书。而在电子书中，<a href="http://www.duokan.com/" target="_blank" rel="external">多看阅读</a>占了大多数，虽然多看的书带有 DRM，但目前似乎还没有出现更理想的替代品。手中的主力阅读器还是第一代 Nexus 7 平板电脑，希望今年能够升级成一台拥有 Retina 分辨率的设备。</p>
<p>下面是2014年读完的书：</p>
<ul>
<li>群山回唱</li>
</ul>
<p>Kindle 电子书。和2013年一样，第一本读完的是小说。这本书与胡赛尼的成名作《追风筝的人》相比，时间跨度更大。从上世纪40年代到最近两年，跨越了整整三代人。虽然还是阿富汗背景的救赎故事，但胡赛尼的叙事手法老练了很多。计划在今年阅读胡赛尼的另一本小说《灿烂千阳》。</p>
<ul>
<li>没有色彩的多崎作和他的巡礼之年</li>
</ul>
<p>来自<a href="http://www.jianshu.com/" target="_blank" rel="external">简书</a>的礼物。村上的小说一定要读纸书，在阅读的过程中会催生出一种莫名的平静感，类似于冥想的效果。尽管读完后对作品本身还是一知半解。</p>
<ul>
<li>思考，快与慢</li>
</ul>
<p>多看特价书。前一年就开始看了，逼着自己看完的一本大部头。后半部分的翻译比较糟糕，有时简直不知所云。</p>
<ul>
<li>松本行弘的程序世界</li>
<li>代码的未来</li>
</ul>
<p>多看特价书。Ruby 之父的著作，在从事《关于 mruby 的一切》的翻译时，这两本书给了我很大的参考价值。</p>
<ul>
<li>高效程序员的45个习惯</li>
</ul>
<p>多看特价书。本以为是面向所有程序员的，看了才知道讲的是敏捷开发的那一套，不是很感冒。</p>
<ul>
<li>万物生长</li>
</ul>
<p>多看特价书。看的第一本可能也是最后一本冯唐的书。冯唐无疑是很有才华的人，但当书中每一处都刻意洋溢着 talent overflow 的感觉时，就不那么有趣了。</p>
<ul>
<li>我编程，我快乐</li>
</ul>
<p>多看特价书。外界的评价很不错，讲的是职业规划，但不知为什么自己看了没有什么感觉。可能这类的书看的多了，会觉得有些陈词滥调。</p>
<ul>
<li>反对完美</li>
</ul>
<p>多看特价书。哈佛《公正》课教授的著书。与公开课一样，桑德尔教授总是能抛出一个尖锐的两难问题，引发人的思考。</p>
<ul>
<li>易中天中华史：奠基者</li>
<li>易中天中华史：国家</li>
<li>易中天中华史：青春志</li>
</ul>
<p>多看特价书。能把中华文化和中国历史写的风趣动人，又不失权威性的，在当今可能只剩易中天先生了。</p>
<ul>
<li>七周七语言</li>
</ul>
<p>多看特价书。开拓视野的一本书。其中函数式编程语言占了大半，看到后面时有些吃力。至今对函数式编程还没有什么概念，感觉讲来讲去也就是和 Ruby 里面的 <code>map</code> 和 <code>inject</code> 方法接收 block 是差不多的意思。在这七门语言中印象最深的要数 Prolog，这门语言完全颠覆了自己对编程的认识。</p>
<ul>
<li>网站UI设计之道</li>
<li>设计师要懂心理学</li>
<li>The CSS3 Anthology 4th Edition</li>
<li>jQuery基础教程（第4版）</li>
<li>JavaScript 权威指南</li>
</ul>
<p>前端技术书，最大的问题是看完后缺少实践。</p>
<ul>
<li>Build Awesome Command-Line Applications in Ruby 2</li>
<li>Crafting Rails 4 Application</li>
</ul>
<p>Ruby 和 Rails 的书籍今年只看了两本，这方面看的更多的是博客文章。其中《Crafting Rails 4 Application》看了两遍，对理解 Rails 的内部运作流程非常有帮助。</p>
<ul>
<li>湘行散记</li>
<li>边城</li>
</ul>
<p>多看限免。印象最深的是沈从文先生对文字的驾驭能力，由于身处白话文正在普及的年代，遣词造句与现在颇为不同。但能够感觉到沈先生用词即优美又传神，让人惋惜为何这些词句未能沿用至今。特别是所有的词都在网络上被玩坏了的今天，能读到这么纯净的汉语已近似于一种享受。</p>
<ul>
<li>背包十年：我的职业是旅行</li>
<li>迟到的间隔年</li>
</ul>
<p>多看限免。暂时无法出去旅行，看看这类书籍也好。《背包十年》的文笔不错，而下面一本要稍微逊色一些。</p>
<ul>
<li>Remote</li>
</ul>
<p>多看特价书。中文名被改成了不伦不类的《重来2》。远程工作是自己的目标，看完后更坚定了远程工作的想法。</p>
<ul>
<li>看见</li>
</ul>
<p>又是来自简书的礼物。记者柴静的成长史。整本书印象最深的是一个德国人在中国山村小学义务支教的故事，在如何陪同孩子成长方面给了我很大的启发。</p>
<ul>
<li>思考的乐趣</li>
</ul>
<p>多看特价书。一位文科生写的介绍数学的书。无奈的是，尽管这本书已经写的足够有趣，但一看到各种公式和代表变量的希腊字母，大脑还是会产生不良反应。这也直接打消了我购买《数学之美》的打算。</p>
<ul>
<li>愤怒的英语</li>
</ul>
<p>多看限免。一个在中国的外教告诉你一些经常被国人误用的英语，只要一个多小时就能看完，还是很值得的。原来「Just so so」是中国式英语，外国人从来不这么说，你知道吗？</p>
<ul>
<li>茶事遍路</li>
</ul>
<p>多看限免。陈舜臣讲述茶的历史。</p>
<ul>
<li>当我谈跑步时，我谈些什么</li>
</ul>
<p>2014年买的唯一一本纸质书，还是计划外购入的。这一年正在努力养成跑步的习惯，所以看看跑步狂人村上春树的跑步自述，有利于激励自己坚持下去。读完后也把「跑一次全程马拉松」加入到了自己的 Bucket List 中。</p>
<ul>
<li>一个游荡者的世界</li>
</ul>
<p>这本书也是计划外匆忙购入的，因为前段时间传言许知远即将被封杀，但现在来看应该属谣言。这本书看似是许知远整理的一本国外游记，但实际上还是在写中国。</p>
<ul>
<li><a href="http://book.douban.com/subject/25966348/" target="_blank" rel="external">スマート・シンキング</a></li>
</ul>
<p>这是2013年在日本购入的书，过了一年半的时间才进入「已读列表」，当然是因为中间停滞了很长时间，最后又是逼着自己看完的。这本书虽然干货不少，但行文风格比较平淡，再加上译者用了很多不常用的日语单词，导致看的很吃力。所以决定以后不再看日语的译文书了。</p>
<ul>
<li><a href="http://book.douban.com/subject/5904073/" target="_blank" rel="external">人生は一冊のノートにまとめなさい</a></li>
</ul>
<p>2011年8月在日本购入的书，这次是第二次看了。这是改变我人生的一本书，受这本书的影响，我开始用纸笔记录自己的每一天，至今已3年有余。所以，现在无论哪一天问我「3年前的今天你做了什么？」，我都可以准确回答。不间断地记录了3年后，是时候找个时间重读这本书，重新寻找坚持下来的意义。</p>
<p>发现这本书也出过<a href="http://book.douban.com/subject/25852019/" target="_blank" rel="external">中文版</a>，虽然没看过，但推荐给大家。</p>
<ul>
<li>阿米的快乐孕期</li>
<li>写给男人的第一本怀孕书</li>
<li>完美怀孕40周全程指导</li>
</ul>
<p>多看限免。在这一年终于派上了用场。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2014/12/01/web-security-book/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/12/01/web-security-book/" itemprop="url">《Web应用安全权威指南》翻译杂感</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-12-01T13:11:00+08:00">
                2014-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/weblog/" itemprop="url" rel="index">
                    <span itemprop="name">weblog</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>《Web应用安全权威指南》在10月份付梓出版了，去年三个月的付出与煎熬终于迎来了成果。手捧沉甸甸的书，看到曾经编辑器中的文字变身成了排版有致的铅字，以及封面上自己的名字（虽然需要借助放大镜才能看清楚），无论翻译的日子里有多少煎熬与痛苦，在这一刻都烟消云散，只留下纯粹的喜悦与欣慰。</p>
<img src="http://vincent-zhao-blog.qiniudn.com/Web应用安全权威指南-展开封面.jpg">
<h2 id="关于本书"><a href="#关于本书" class="headerlink" title="关于本书"></a>关于本书</h2><p>《Web应用安全权威指南》，顾名思义，介绍的是如何打造安全的 Web 应用。内容详情和部分章节试读可以在<a href="http://www.ituring.com.cn/book/1249" target="_blank" rel="external">图灵社区的页面上</a>找到，这里就不重复赘述了。</p>
<p>和其他日系的技术书一样，本书的行文风格也是细致入微，并不假定读者对某些概念已有了解，所以非常适合想要系统性学习 Web 开发中各种常见和不常见的安全隐患的读者。本书的另外一个亮点是配备了开箱即用的虚拟机环境，读者可以亲手针对 Web 应用的漏洞发起攻击，体验「键盘在手，天下我有」的快感，通过实践，强化对安全隐患的理解。</p>
<h2 id="翻译杂感"><a href="#翻译杂感" class="headerlink" title="翻译杂感"></a>翻译杂感</h2><p>这是我第一次参与书籍的翻译，在翻译这本书之前，我翻译过国外的一些博客文章，算是积累了少许翻译经验。然而书籍的翻译和文章的翻译不可同日而语。翻译一篇文章仅需数个小时，跨度一般不会超过一天，好比短距离冲刺。而书籍的翻译则更像是马拉松，要连续耗费两到三个月的时间，多数技术书译者白天还有本职工作，对译者能否合理地管理自己的时间和精力是一个不小的挑战。</p>
<p>这本书的翻译过程绝非一气呵成。经过了最开始大约两周的热情，倦怠期就开始袭来。让自己坐下来翻译变的越来越困难，最严重的时候不得不祭出番茄工作法，才能让自己专注下来。翻译期间，我每天都会在 Day One 中写下自己的心情，现在翻看，多数是自己与拖延症不断搏斗的经历。自己每天的业余生活不是在翻译就是在拖延翻译，最后能如约交稿实在是万幸。</p>
<p>虽然有些许痛苦的回忆，但显然无法与得到的收获相提并论。锻炼了外语能力自然不必说。我的本职工作就是开发 Web 应用程序，因此翻译的过程中也学到了许多干货，提升了自己的职业技能。另外，我最初会开始翻译文章，其实是为了锻炼自己使用中文遣词造句的能力。一开始想自己写文章，却苦于大脑中无货，于是打算着先从翻译文章做起。所以对我来说，翻译还是一种学习写作的途径。</p>
<p>这本书顺利出版后，以目前得到的有限的反馈来看，几乎都是正面的。我感到很欣慰，没有因为翻译的质量问题而辜负了作者德丸浩先生的心血。而读者集中反馈的一个问题是本书所附带的虚拟机文件还是日文的环境，没有对其进行汉化。在这里要向购买本书的读者道歉，这个问题确实是我的疏漏。由于我没接触过 VMWare 的虚拟机系统，所以当时没有将其汉化。现在出版方应该找人着手在处理这个问题了。</p>
<p>亲身参与了一次书籍的翻译后，我也大致明白了大家吐槽国内的翻译书籍质量不高的原因了。因为译者的付出与回报不成比例，除非是明星译者，否则几乎不可能单靠翻译来养活自己。付出同样的时间并产出同样质量的代码和译文，前者获得的金钱上的回报通常会是后者的数倍甚至十倍，更不用提超过800元就需缴纳高达20%的稿税。另外，出版纸书的周期过长也是一个不小的问题。从我最后一次提交译稿的11月，到书籍正式出版的来年10月，中间等待了将近一年的时间。如此种种，形成了市面上优秀的翻译书籍稀少的局面。再加上我们对知识产权缺乏尊重，很难说到底是鸡生蛋还是蛋生鸡，从结果来看就造成了现在这番恶性循环。</p>
<p>虽然还存在种种问题，但还是很高兴的看到图灵社区上仍然有源源不断的好书正在被翻译。我在翻译完这本书后，也继续参与翻译了<a href="http://www.ituring.com.cn/book/1339" target="_blank" rel="external">一本只发行电子书的小册子</a>，纯粹是因为感兴趣。相信现在仍然积极投身翻译事业的人们，也是怀揣着同样的热情吧。</p>
<p>我想以后如果有合适的机会的话，我还会再次尝试翻译一本书的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2014/10/27/how-does-rails-handle-gems/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/27/how-does-rails-handle-gems/" itemprop="url">Rails 是如何处理 Gems 的？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-27T20:01:00+08:00">
                2014-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/translation/" itemprop="url" rel="index">
                    <span itemprop="name">translation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文: <a href="http://www.justinweiss.com/blog/2014/10/13/how-does-rails-handle-gems/" target="_blank" rel="external">How Does Rails Handle Gems?</a></p>
<p>之前我写过<a href="http://zhaowen.me/blog/2014/10/14/how-do-gems-work/">一篇文章来介绍 RubyGems 如何管理 Ruby 的加载路径</a>。然而 Rails 并没有直接使用 RubyGems，而是使用 <a href="http://bundler.io/" target="_blank" rel="external">Bundler</a> 来管理 gems。</p>
<p>如果不明白 Bundler 的运行机制，那么 Rails 自动将 gems 加载到应用中的举动似乎会显得过于神奇。只需要在 <code>Gemfile</code> 中添加一行代码，竟然就能够在应用中使用 gem 中的代码了？Bundler、Rails 和 RubyGems 是怎样通力合作，将处理 gems 的依赖关系的过程变得轻松的呢？</p>
<h2 id="为什么是-Bundler？"><a href="#为什么是-Bundler？" class="headerlink" title="为什么是 Bundler？"></a>为什么是 Bundler？</h2><p>我把 Bundler 想象成一位严格的 gem 管理员。也就是说，Bundler 帮你安装你所需要的正确版本的 gems，并强制你的应用只使用你指定的版本。</p>
<p>这太有用了，要知道为什么，我们必须要回溯到没有 Bundler 的日子里是什么样的光景。</p>
<p>在 Bundler 出现以前，要安装指定版本的 gems 还是相当容易的，可以使用一些配置脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gem install rails -v 4.1.0</div><div class="line">gem install rake -v 10.3.2</div><div class="line">...</div></pre></td></tr></table></figure>
<p>（但是要确保以上脚本中 Rails 4.1 的依赖关系不与 Rake 10.3.2 冲突！）</p>
<p>可是如果你正在开发多个 Rails 应用，并且每个应用都使用不同版本的 gems，会发生什么呢？除非你特别细心，否则你肯定会遭遇到令人闻风丧胆的激活 gem 异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Gem::Exception: can&apos;t activate hpricot (= 0.6.161, runtime),</div><div class="line">already activated hpricot-0.8.3</div></pre></td></tr></table></figure>
<p>呃，这条错误消息映入眼帘时，脑海中还是会浮现从前那些不堪回首的日子。这个错误的出现通常意味着你将花上一整天的时间来安装和卸载 gems，来确保机器上 gems 都安装了正确的版本。一个不经意的 <code>gem install rake</code> 就可能会完全搞乱你精心准备的计划。</p>
<p><a href="https://rvm.io/gemsets/basics" target="_blank" rel="external">rvm gemsets</a> 的出现暂时减缓了这个问题。然而 gemsets 配置起来很耗时，而且一旦你不小心安装到了错误的 gemset 中以后，还是会遇到和以前相同的问题。而有了 Bundler 之后，你几乎不用去考虑 gems 之间的依赖关系，你的应用通常情况下就会正常工作。而且 Bundler 比起 gemsets 要容易配置的多。</p>
<p>总的来说，Bundler 帮你做了两件重要的事。它安装所有你需要的 gems 并且锁定了 RubyGems，使得你在 Rails 应用内部只能加载那些指定的 gems。</p>
<h2 id="Rails-如何使用-Bundler"><a href="#Rails-如何使用-Bundler" class="headerlink" title="Rails 如何使用 Bundler"></a>Rails 如何使用 Bundler</h2><p>Bundle 最关键的作用是安装并隔离你的 gems，但却不止于此。<code>Gemfile</code> 中的 gems 的代码是如何被加载到 Rails 应用里面的呢？</p>
<p>如果你看过 <code>bin/rails</code> 文件：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env ruby</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">  load File.expand_path(<span class="string">"../spring"</span>, __FILE_<span class="number">_</span>)</div><div class="line"><span class="keyword">rescue</span> LoadError</div><div class="line"><span class="keyword">end</span></div><div class="line">APP_PATH = File.expand_path(<span class="string">'../../config/application'</span>,  __FILE_<span class="number">_</span>)</div><div class="line">require_relative <span class="string">'../config/boot'</span></div><div class="line"><span class="keyword">require</span> <span class="string">'rails/commands'</span></div></pre></td></tr></table></figure>
<p>能看到它通过 require <code>../config/boot</code> 来启动 Rails。来看看这个文件吧：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ENV[<span class="string">'BUNDLE_GEMFILE'</span>] <span class="params">||</span>= File.expand_path(<span class="string">'../../Gemfile'</span>, __FILE_<span class="number">_</span>)</div><div class="line"></div><div class="line"><span class="keyword">require</span> <span class="string">'bundler/setup'</span> <span class="comment"># Set up gems listed in the Gemfile.</span></div></pre></td></tr></table></figure>
<p>嘿，看到 Bundler 了！（这里我还学到了一招，你可以通过设定环境变量 <code>BUNDLE_GEMFILE</code> 来指定不同的 <code>Gemfile</code>，这很酷。）</p>
<p><code>bundler/setup</code> 做了几件事：</p>
<ul>
<li>它移除了 <code>$LOAD_PATH</code> 中所有 gems 的路径（相当于将 RubyGems 所做的工作都撤销了）</li>
<li>然后，它仅将 <code>Gemfile.lock</code> 中出现的 gems 加到 <code>$LOAD_PATH</code> 中</li>
</ul>
<p>这样一来，你能 <code>require</code> 的 gems 就仅限于 <code>Gemfile</code> 中的那些 gems 了。</p>
<p>到了这里，所有你需要的 gems 都在加载路径中了。但是当你使用 RubyGems 的时候，按理说你仍然需要 <code>require</code> 你所需要的文件。使用 Rails 的时候我们为什么不用 <code>require</code> 就能使用呢？</p>
<p>快速来看一下 <code>config/application.rb</code>，这个文件在 Rails 启动后就会被执行：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Require the gems listed in Gemfile, including any gems</span></div><div class="line"><span class="comment"># you've limited to :test, :development, or :production.</span></div><div class="line">Bundler.<span class="keyword">require</span>(*Rails.groups)</div></pre></td></tr></table></figure>
<p>又看到 Bundler 了！<code>Bundler.require</code> 会加载传递给它的 group 中所有的 gems。（group 是指<a href="http://bundler.io/v1.7/groups.html" target="_blank" rel="external">你在 Gemfile 中指定的 group</a>）</p>
<p>那么 <code>Rails.groups</code> 包含了哪些 group 呢？</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Returns all rails groups for loading based on:</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># * The Rails environment;</span></div><div class="line"><span class="comment"># * The environment variable RAILS_GROUPS;</span></div><div class="line"><span class="comment"># * The optional envs given as argument and the hash with group dependencies;</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   groups assets: [:development, :test]</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#   # Returns</span></div><div class="line"><span class="comment">#   # =&gt; [:default, :development, :assets] for Rails.env == "development"</span></div><div class="line"><span class="comment">#   # =&gt; [:default, :production]           for Rails.env == "production"</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">groups</span><span class="params">(*groups)</span></span></div><div class="line"> hash = groups.extract_options!</div><div class="line"> env = Rails.env</div><div class="line"> groups.unshift(<span class="symbol">:default</span>, env)</div><div class="line"> groups.concat ENV[<span class="string">"RAILS_GROUPS"</span>].to_s.split(<span class="string">","</span>)</div><div class="line"> groups.concat hash.map &#123; <span class="params">|k, v|</span> k <span class="keyword">if</span> v.map(&amp;<span class="symbol">:to_s</span>).<span class="keyword">include</span>?(env) &#125;</div><div class="line"> groups.compact!</div><div class="line"> groups.uniq!</div><div class="line"> groups</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>上述代码回答了这个问题。以 development 模式启动 Rails 时，<code>Rails.groups</code> 的值为 <code>[:default, :development]</code>，而以 production 模式启动 Rails 时，<code>Rails.groups</code> 的值为 <code>[:default, :production]</code>，等等。</p>
<p>所以，Bundler 会去 <code>Gemfile</code> 中查找属于指定 group 的 gems，并且对每个找到的 gem 执行 <code>require</code>。如果你写了 <code>nokogiri</code> 这个 gem，它就会替你执行 <code>require &quot;nokogiri&quot;</code>。这就解释了为什么你无需写任何多余的代码，就能使你的 gems 在 Rails 中正常工作。</p>
<h2 id="了解手中的工具"><a href="#了解手中的工具" class="headerlink" title="了解手中的工具"></a>了解手中的工具</h2><p>当你能够很好的了解你手头的工具以后，你就会更加好的使用它们。因此，如果你长时间的使用某样东西，最好花一些时间来对它进行一番深入的研究。</p>
<p>如果你使用 Ruby 和 Rails，那你每天都会和 gems 打交道。抽些时间来好好学习它们吧！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2014/10/14/how-do-gems-work/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/10/14/how-do-gems-work/" itemprop="url">Ruby Gems 是如何运作的？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-10-14T20:01:00+08:00">
                2014-10-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/translation/" itemprop="url" rel="index">
                    <span itemprop="name">translation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文: <a href="http://www.justinweiss.com/blog/2014/09/29/how-do-gems-work/" target="_blank" rel="external">How Do Gems Work?</a></p>
<p>Ruby gems 在通常情况下能够运转自如，但 Ruby 的魔法背后始终隐藏着一个不小的问题：发生错误后很难找出原因所在。</p>
<p>Gems 一般不会出现问题，然而一旦发生了，搜索引擎却常常会显得无能为力。笼统的错误消息根本无法帮助我们定位问题的出处。如果你不明白 Ruby 中的 gems 是如何运作的，独自调试这些问题对你来说无疑会是一段痛苦的经历。</p>
<p>Gems 看上去很魔幻，但只要经过一小番探索，你会发现其实并非那么难以理解。</p>
<h2 id="gem-install-做了什么？"><a href="#gem-install-做了什么？" class="headerlink" title="gem install 做了什么？"></a>gem install 做了什么？</h2><p>一个 Ruby gem 只是一些被打包的代码，再加上一些额外的数据。通过 <code>gem unpack</code> 命令，你可以看到 gem 内部的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">~/Source/playground jweiss$ gem unpack resque_unit</div><div class="line">Fetching: resque_unit-0.4.8.gem (100%)</div><div class="line">Unpacked gem: &apos;/Users/jweiss/Source/playground/resque_unit-0.4.8&apos;</div><div class="line">~/Source/playground jweiss$ cd resque_unit-0.4.8</div><div class="line">~/Source/playground/resque_unit-0.4.8 jweiss$ find .</div><div class="line">.</div><div class="line">./lib</div><div class="line">./lib/resque_unit</div><div class="line">./lib/resque_unit/assertions.rb</div><div class="line">./lib/resque_unit/errors.rb</div><div class="line">./lib/resque_unit/helpers.rb</div><div class="line">./lib/resque_unit/plugin.rb</div><div class="line">./lib/resque_unit/resque.rb</div><div class="line">./lib/resque_unit/scheduler.rb</div><div class="line">./lib/resque_unit/scheduler_assertions.rb</div><div class="line">./lib/resque_unit.rb</div><div class="line">./lib/resque_unit_scheduler.rb</div><div class="line">./README.md</div><div class="line">./test</div><div class="line">./test/resque_test.rb</div><div class="line">./test/resque_unit_scheduler_test.rb</div><div class="line">./test/resque_unit_test.rb</div><div class="line">./test/sample_jobs.rb</div><div class="line">./test/test_helper.rb</div><div class="line">~/Source/playground/resque_unit-0.4.8 jweiss$</div></pre></td></tr></table></figure>
<p><code>gem install</code> 命令最简单的行为如下，它获取 gem 后将其文件存储到你系统上一个特别的目录下。你可以运行 <code>gem environment</code> 命令来查看 <code>gem install</code> 命令把 gems 安装到哪里（找到 <code>INSTALLATION DIRECTORY:</code> 行）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">~ jweiss$ gem environment</div><div class="line">RubyGems Environment:</div><div class="line">  - RUBYGEMS VERSION: 2.2.2</div><div class="line">  - RUBY VERSION: 2.1.2 (2014-05-08 patchlevel 95) [x86_64-darwin14.0]</div><div class="line">  - INSTALLATION DIRECTORY: /usr/local/Cellar/ruby/2.1.2/lib/ruby/gems/2.1.0</div><div class="line">  ...</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">~ jweiss$ ls /usr/local/Cellar/ruby/2.1.2/lib/ruby/gems/2.1.0</div><div class="line">bin           bundler     doc         gems</div><div class="line">build_info    cache       extensions  specifications</div></pre></td></tr></table></figure>
<p>所有已安装的 gem 代码都在那里，在 <code>gems</code> 目录下面。</p>
<p>上述路径随着操作系统的不同而不同，同样也取决于 Ruby 的安装方式（rvm 与 Homebrew 不同，与 rbenv 也不同，等等）。所以如果你想知道 gems 的代码在哪里，<code>gem environment</code> 命令会是一个好帮手。</p>
<h2 id="gem-代码怎样被加载？"><a href="#gem-代码怎样被加载？" class="headerlink" title="gem 代码怎样被加载？"></a>gem 代码怎样被加载？</h2><p>为了让 gems 中的代码被使用到，RubyGems 覆写了 Ruby 的 <code>require</code> 方法。具体的代码在 <a href="https://github.com/rubygems/rubygems/blob/169b12eb5815784d7ee721186456ad20a004ce71/lib/rubygems/core_ext/kernel_require.rb#L38" target="_blank" rel="external">core_ext/kernel_require.rb</a>。注释写的很清楚：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">##</span></div><div class="line"><span class="comment"># When RubyGems is required, Kernel#require is replaced with our own which</span></div><div class="line"><span class="comment"># is capable of loading gems on demand.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># When you call &lt;tt&gt;require 'x'&lt;/tt&gt;, this is what happens:</span></div><div class="line"><span class="comment"># * If the file can be loaded from the existing Ruby loadpath, it</span></div><div class="line"><span class="comment">#   is.</span></div><div class="line"><span class="comment"># * Otherwise, installed gems are searched for a file that matches.</span></div><div class="line"><span class="comment">#   If it's found in gem 'y', that gem is activated (added to the</span></div><div class="line"><span class="comment">#   loadpath).</span></div><div class="line"><span class="comment">#</span></div></pre></td></tr></table></figure>
<p>比方说你要加载 <code>active_support</code>，RubyGems 会尝试使用 Ruby 的 <code>require</code> 方法来加载，这时会得到如下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">LoadError: cannot load such file -- active_support</div><div class="line">  from (irb):17:in `require&apos;</div><div class="line">  from (irb):17</div><div class="line">  from /usr/local/bin/irb:11:in `&lt;main&gt;&apos;</div></pre></td></tr></table></figure>
<p>RubyGems <a href="https://github.com/rubygems/rubygems/blob/169b12eb5815784d7ee721186456ad20a004ce71/lib/rubygems/core_ext/kernel_require.rb#L125" target="_blank" rel="external">看到了这个错误消息</a>，知道了需要去寻找某个 gem 中的 <code>active_support.rb</code>。然后它<a href="https://github.com/rubygems/rubygems/blob/169b12eb5815784d7ee721186456ad20a004ce71/lib/rubygems/specification.rb#L927" target="_blank" rel="external">扫描所有 gems 的 metadata</a>，寻找其中包含 <code>active_support.rb</code> 的 gem：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">irb(main):001:0&gt; spec = Gem::Specification.find_by_path(&apos;active_support&apos;)</div><div class="line">=&gt; #&lt;Gem::Specification:0x3fe366874324 activesupport-4.2.0.beta1&gt;</div></pre></td></tr></table></figure>
<p>找到以后，RubyGems 将其激活，并把 gem 中的代码添加到了 Ruby 的加载路径（load path，也就是你可以 <code>require</code> 其他文件的地方）中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">irb(main):002:0&gt; $LOAD_PATH</div><div class="line">=&gt; [&quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/site_ruby/2.1.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/site_ruby/2.1.0/x86_64-darwin14.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/site_ruby&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/vendor_ruby/2.1.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/vendor_ruby/2.1.0/x86_64-darwin14.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/vendor_ruby&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/2.1.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/2.1.0/x86_64-darwin14.0&quot;]</div><div class="line">irb(main):003:0&gt; spec.activate</div><div class="line">=&gt; true</div><div class="line">irb(main):004:0&gt; $LOAD_PATH</div><div class="line">=&gt; [&quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/gems/2.1.0/gems/i18n-0.7.0.beta1/lib&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/gems/2.1.0/gems/thread_safe-0.3.4/lib&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/gems/2.1.0/gems/activesupport-4.2.0.beta1/lib&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/site_ruby/2.1.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/site_ruby/2.1.0/x86_64-darwin14.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/site_ruby&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/vendor_ruby/2.1.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/vendor_ruby/2.1.0/x86_64-darwin14.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/vendor_ruby&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/2.1.0&quot;, &quot;/usr/local/Cellar/ruby/2.1.2/lib/ruby/2.1.0/x86_64-darwin14.0&quot;]</div></pre></td></tr></table></figure>
<p>既然 <code>active_support</code> 已经被加到了加载路径中，你就可以像往常一样 <code>require</code> gem 中的文件了。你甚至可以使用原始的 <code>require</code> 方法，也就是被 RubyGems 所覆写的哪个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">irb(main):005:0&gt; gem_original_require &apos;active_support&apos;</div><div class="line">=&gt; true</div></pre></td></tr></table></figure>
<p>酷！</p>
<h2 id="小知识，大用处"><a href="#小知识，大用处" class="headerlink" title="小知识，大用处"></a>小知识，大用处</h2><p>RubyGems 看上去很复杂，但它最基础的用途只是替你管理 Ruby 的加载路径。但也不是说 RubyGems 都很简单，这里没有涉及 RubyGems 如何管理 gems 的版本冲突、gem 二进制文件（比如 <code>rails</code> 和 <code>rake</code>）、C 语言扩展等其他内容。</p>
<p>然而，即使只了解 RubyGems 的基础内容也会对你产生很大的帮助。经过一番简单的源码阅读和 <code>irb</code> 中的实践后，你就知道了怎样去深入探索 gems 代码。你知道了你的 gems 都在哪里，所以能确保 RubyGems 也能找到它们。一旦你明白了 gems 的加载过程，你也就有能力去解决一些看上去很棘手的加载方面的问题了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2014/06/25/ruby-2-dot-0-in-detail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/25/ruby-2-dot-0-in-detail/" itemprop="url">Ruby 2.0.0 更新详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-25T20:32:00+08:00">
                2014-06-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/translation/" itemprop="url" rel="index">
                    <span itemprop="name">translation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>译者注：截至目前，Ruby 的最新版已经更新到了 2.1.2。为什么今时今日还要翻译 2.0.0 版本的变更点呢？众所周知，语言越小众，用户的升级越激进。而 Ruby 进入 1.9 以后，已经名副其实地跻身主流语言。当一门语言被广泛使用以后，版本升级的步伐也会相对放缓。目前我在工作上的项目使用的依然是 Ruby 1.9.3，我当时学习 Ruby 时候的版本的也是 1.9。但显然，将版本升级到 2.0 以上是大势所趋，为了全面地了解 1.9.3 到 2.0.0 之间发生了哪些变化，我选择了这篇非常全面的文章进行了翻译。希望对有同样需求的人有所帮助。</p>
</blockquote>
<p>原文： <a href="http://globaldev.co.uk/2013/03/ruby-2-0-0-in-detail/" target="_blank" rel="external">Ruby 2.0.0 in Detail</a></p>
<h2 id="关键字参数（Keyword-arguments）"><a href="#关键字参数（Keyword-arguments）" class="headerlink" title="关键字参数（Keyword arguments）"></a>关键字参数（Keyword arguments）</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(string, <span class="symbol">before:</span> <span class="string">"&lt;"</span>, <span class="symbol">after:</span> <span class="string">"&gt;"</span>)</span></span></div><div class="line">  <span class="string">"<span class="subst">#&#123;before&#125;</span><span class="subst">#&#123;string&#125;</span><span class="subst">#&#123;after&#125;</span>"</span> <span class="comment"># 无需从 hash 中获取 options</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 有无任意</span></div><div class="line">wrap(<span class="string">"foo"</span>)                                  <span class="comment">#=&gt; "&lt;foo&gt;"</span></div><div class="line"><span class="comment"># 数量任意</span></div><div class="line">wrap(<span class="string">"foo"</span>, <span class="symbol">before:</span> <span class="string">"#&lt;"</span>)                    <span class="comment">#=&gt; "#&lt;foo&gt;"</span></div><div class="line">wrap(<span class="string">"foo"</span>, <span class="symbol">after:</span> <span class="string">"]"</span>)                      <span class="comment">#=&gt; "&lt;foo]"</span></div><div class="line"><span class="comment"># 顺序任意</span></div><div class="line">wrap(<span class="string">"foo"</span>, <span class="symbol">after:</span> <span class="string">"]"</span>, <span class="symbol">before:</span> <span class="string">"["</span>)         <span class="comment">#=&gt; "[foo]"</span></div></pre></td></tr></table></figure>
<p>相比用 hash 来实现的伪关键字参数的方式，该特性的好处之一为，当出现单词拼写错误时会报错。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">begin</span></div><div class="line">  wrap(<span class="string">"foo"</span>, <span class="symbol">befoer:</span> <span class="string">"#&lt;"</span>)</div><div class="line"><span class="keyword">rescue</span> ArgumentError =&gt; e</div><div class="line">  e.message                                  <span class="comment">#=&gt; "unknown keyword: befoer"</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>如同使用一个星号来捕获所有的常规参数一样，可以使用两个星号来捕获所有的关键字参数。两个星号还能用于将 hash 转换为关键字参数。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># arguments</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">capture</span><span class="params">(**opts)</span></span></div><div class="line">  opts</div><div class="line"><span class="keyword">end</span></div><div class="line">capture(<span class="symbol">foo:</span> <span class="string">"bar"</span>)                          <span class="comment">#=&gt; &#123;:foo=&gt;"bar"&#125;</span></div><div class="line"></div><div class="line"><span class="comment"># key 必须为 symbol</span></div><div class="line">opts = &#123;<span class="symbol">:before</span> =&gt; <span class="string">"("</span>, <span class="symbol">:after</span> =&gt; <span class="string">")"</span>&#125;</div><div class="line">wrap(<span class="string">"foo"</span>, **opts)                          <span class="comment">#=&gt; "(foo)"</span></div></pre></td></tr></table></figure>
<p>关键字参数仍然能够接收旧式的 hash 形式参数，因此你可以放心地更新方法定义，而无需修改每一处调用它的地方。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wrap(<span class="string">"foo"</span>, <span class="symbol">:before</span> =&gt; <span class="string">"&#123;"</span>, <span class="symbol">:after</span> =&gt; <span class="string">"&#125;"</span>)   <span class="comment">#=&gt; "&#123;foo&#125;"</span></div></pre></td></tr></table></figure>
<p>如果你的库需要兼容 Ruby 2.0 和 1.9，那么仍然可以采用以前的 hash 形式的伪关键字参数，因为调用的时候和关键字参数的写法是一样的。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(string, opts=&#123;&#125;)</span></span></div><div class="line">  before = opts[<span class="symbol">:before</span>] <span class="params">||</span> <span class="string">"&lt;"</span></div><div class="line">  after = opts[<span class="symbol">:after</span>] <span class="params">||</span> <span class="string">"&gt;"</span></div><div class="line">  <span class="string">"<span class="subst">#&#123;before&#125;</span><span class="subst">#&#123;string&#125;</span><span class="subst">#&#123;after&#125;</span>"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">wrap(<span class="string">"foo"</span>, <span class="symbol">before:</span> <span class="string">"["</span>, <span class="symbol">after:</span> <span class="string">"]"</span>)         <span class="comment">#=&gt; "[foo]"</span></div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2014/06/25/ruby-2-dot-0-in-detail/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhaowen.me/2014/05/20/the-last-of-us/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Vincent Zhao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/zhaowen.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Vincent Zhao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/05/20/the-last-of-us/" itemprop="url">The Last of Us</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-05-20T21:54:00+08:00">
                2014-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/weblog/" itemprop="url" rel="index">
                    <span itemprop="name">weblog</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://www.spotlightreport.net/wp-content/uploads/2013/01/the-last-of-us-banner-3.jpg" alt="THE LAST OF US"></p>
<p>一个多月没有更新博客了，因为整个4月份都投入进了「The Last of Us」这款 PS3 游戏。时至今日，虽然已经决定封盘，游戏的种种还在脑海中萦绕。</p>
<p>游戏在去年6月就发售了，好评如潮，权威媒体不吝赞美之词，相继给出满分。彼时身在日本，无法第一时间体验这款惊世之作，惋惜不已。回国以后也总是抽不出时间来唤醒沉睡已久的 PS3，一度以为自己对电子游戏的热情已然熄灭，不禁扼腕。</p>
<p>The Last of Us 无疑是一剂镇心剂，耗费了一整个月的业余时间，连续通关2遍，并强烈克制住了自己想要开始三周目的冲动。</p>
<p>究竟什么魔力能让人如此欲罢不能？</p>
<h2 id="流畅的节奏"><a href="#流畅的节奏" class="headerlink" title="流畅的节奏"></a>流畅的节奏</h2><p>传统的 AVG 或 RPG 等以剧情驱动的游戏类型中，总会有「过场动画」这一元素，如同电影一样，这段时间玩家只能被动地消费信息。这个环节对玩家来说，是整个游戏过程中最没有参与感的部分，如果时间过长难免引发反感。令人发指者如 Metal Gear Solid，大段的过长动画广为人诟病，更莫提丧心病狂的大段无线电远程对话。</p>
<p>这一状况由 God of War 引入的名为 QTE 的系统而有所改善。QTE 即过场动画中会不时需要玩家按照画面提示来进行相应的按键，如果按错一般会立即死亡，普遍出现在剧情发展到危及时刻。通过这种方式，玩家和游戏中的人物形成了某种羁绊，增强了代入感。迄今 QTE 早已屡见不鲜，The Last of Us 当然也不例外。</p>
<p>但 The Last of Us 又向前推进了一步，它将过场动画进行了最大程度的压缩，而将推动剧情发展的人物对话尽可能地插入到玩家可操作的过场中。也就是说，我们在操作人物移动时，同时在进行主线对话。</p>
<p>为了达到无缝连接的效果，顽皮狗也做了一些努力，比如在对话的时候降低角色的移动速度，使奔跑操作无效，以保证对话进行的时间。再如由于 NPC 也在向前行走，如果玩家控制的角色没有跟上，NPC 会停下来等待玩家，等到玩家跟上以后再继续下一段对话。</p>
<p>再比如游戏刚开始不久的驾车逃离那一段，玩家控制的小萝莉坐在后座，为了增强互动性，这时玩家可以转动小萝莉的视角来观察周围的世界。</p>
<p>所以从始至终，几乎很少会有传统意义上的过场动画，保证了连续性，全程无尿点，让人根本停不下来。</p>
<h2 id="剧情"><a href="#剧情" class="headerlink" title="剧情"></a>剧情</h2><p>在此之前只玩过一款顽皮狗的作品，就是名声与本作不相上下的 「Uncharted 2」 。Uncharted 2 在当时也是划时代的作品，以以假乱真的画质和紧张的节奏著称，然而说起剧情，却鲜有赞誉之词。</p>
<p>The Last of Us 在保留了 Uncharted 所有优点的基础上，同时给出了一流的剧情。</p>
<p>末世题材向来是挖掘人性的最佳舞台。本作值得圈点的情节实在太多。军队的集权统治、猎人团伙的弱肉强食、Joel 和 Ellie 的关系转化、人类与自然环境的共存规则等等。最让人津津乐道的莫过于结局时 Joel 争议性的决定。</p>
<p>除了台面上进行的情节，游戏还通过遗物的形式巧妙地展示了几段发生在过去的凄美故事。比如居住在下水道中的社群，以及 DLC 中直升机里面的几位救援兵的经历。让整个作品饱满不少。</p>
<p>如此优秀的剧情自然引起了影视界的兴趣，本作已经确定要改编成电影。但个人并不十分看好电影版，正如前面所说，缺少了互动之后，震撼程度无疑将会大打折扣。</p>
<hr>
<p>除此之外，逼真的画质、神来之笔的音乐、适中的难度、进化的战斗系统等共同造就了这款非凡的游戏。</p>
<p>谨以这篇应试作文风格的「玩后感」，纪念 The Last of Us 曾给自己带来的美妙时光。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/zhaowen.png"
               alt="Vincent Zhao" />
          <p class="site-author-name" itemprop="name">Vincent Zhao</p>
           
              <p class="site-description motion-element" itemprop="description">程序员，玩家，死理性派，工具控，拖延症，右脑探索者</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">39</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="mailto:zhaowen869@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/VincentZhao" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/zhaowenchina" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                    
                      Twitter
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/Vincent__Zhao" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      微博
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/2872840/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      豆瓣
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/zhao-wen-27" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      知乎
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vincent Zhao</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="https://ajax.lug.ustc.edu.cn/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
